# Тесты для GupshupPartnerServiceClient

Этот файл содержит комплексные тесты для класса `GupshupPartnerServiceClient`, который обеспечивает аутентификацию в партнерском портале Gupshup.

## Структура тестов

### 1. Тесты конструктора (`constructor`)
- **Создание axios instance с правильным base URL** - проверяет, что axios создается с корректным URL
- **Создание без debug логирования по умолчанию** - проверяет, что debug логирование отключено по умолчанию
- **Настройка debug логирования при включении** - проверяет, что перехватчики настраиваются при включении debug режима
- **Проверка конфигурации логгера** - проверяет, что перехватчики вызываются корректно
- **Обработка различных опций конфигурации** - проверяет создание клиента с разными конфигурациями

### 2. Тесты метода `getPartnerToken`
- **Успешная аутентификация** - проверяет корректную работу аутентификации
- **Обработка ошибок аутентификации** - проверяет обработку неверных учетных данных
- **Обработка сетевых ошибок** - проверяет обработку сетевых проблем
- **Обработка серверных ошибок (5xx)** - проверяет обработку ошибок сервера
- **Обработка клиентских ошибок (4xx)** - проверяет обработку ошибок клиента
- **Обработка пустого email** - проверяет работу с пустым email
- **Обработка пустого пароля** - проверяет работу с пустым паролем
- **Обработка специальных символов** - проверяет работу с email и паролем, содержащими специальные символы
- **Обработка минимальных данных ответа** - проверяет работу с ответом, содержащим только токен
- **Обработка расширенных данных ответа** - проверяет работу с ответом, содержащим дополнительные поля

### 3. Интеграционные сценарии
- **Работа с включенным debug режимом** - проверяет полную работу в debug режиме
- **Обработка множественных последовательных вызовов** - проверяет работу с несколькими вызовами подряд

### 4. Обработка граничных случаев ошибок
- **Обработка ошибок таймаута** - проверяет обработку превышения времени ожидания
- **Обработка некорректных данных ответа** - проверяет обработку ответов с null данными
- **Обработка ответов без поля token** - проверяет обработку ответов без токена
- **Обработка очень длинных email и пароля** - проверяет работу с очень длинными строками
- **Обработка Unicode символов** - проверяет работу с Unicode символами в email и пароле

## Покрытие кода

Тесты обеспечивают высокое покрытие кода:
- **Statements**: 86.66%
- **Branch**: 92.85%
- **Functions**: 75%
- **Lines**: 100%

## Запуск тестов

```bash
# Запуск всех тестов
npm test

# Запуск только тестов для GupshupPartnerServiceClient
npm test -- src/GupshupPartnerServiceClient/spec/GupshupPartnerServiceClientSpec.ts

# Запуск с покрытием кода
npm test -- --coverage src/GupshupPartnerServiceClient/spec/GupshupPartnerServiceClientSpec.ts
```

## Моки и зависимости

Тесты используют следующие моки:
- **axios** - полностью замокан для изоляции тестов от реальных HTTP запросов
- **axios-logger** - не тестируется напрямую, так как используется только в debug режиме

## Структура моков

```typescript
const mockAxiosInstance = {
  post: jest.fn(),
  get: jest.fn(),
  // ... другие методы
  interceptors: {
    request: { use: jest.fn(), eject: jest.fn(), clear: jest.fn() },
    response: { use: jest.fn(), eject: jest.fn(), clear: jest.fn() }
  },
  defaults: {}
};
```

## Примеры использования

### Базовый тест успешного сценария
```typescript
it('should successfully authenticate and return token', async () => {
  const mockAxiosResponse = {
    data: { token: 'mock-token-12345' },
    status: 200,
    statusText: 'OK',
    headers: {},
    config: {} as any,
  };

  mockAxiosInstance.post.mockResolvedValue(mockAxiosResponse);
  const result = await client.getPartnerToken('test@example.com', 'password');
  expect(result).toEqual({ token: 'mock-token-12345' });
});
```

### Тест обработки ошибок
```typescript
it('should handle authentication failure', async () => {
  const mockError = new Error('Invalid credentials');
  mockAxiosInstance.post.mockRejectedValue(mockError);
  
  await expect(client.getPartnerToken('test@example.com', 'wrong-password'))
    .rejects.toThrow('Invalid credentials');
});
```

## Рекомендации по расширению тестов

1. **Добавить тесты для новых методов** - при добавлении новых методов в класс
2. **Расширить тесты edge cases** - добавить тесты для новых граничных случаев
3. **Добавить интеграционные тесты** - тесты с реальными HTTP запросами (в отдельной среде)
4. **Добавить performance тесты** - для проверки производительности при больших объемах данных 